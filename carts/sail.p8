pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
function _init()
	init_player()
	wind_dir = "south"
	player_points = {}
	player_points[1] = 0
	overall_player_speed = .5
	water_drag = 1

end

function _update()
	rotate_player()
	move_player()
end

function _draw()
	cls()
	draw_water()
	draw_marks()
	draw_player()
	draw_points()
end

function init_player()
	player = {}
	player.x = 50
	player.y = 50
	player.dx = 0;
	player.dy = 0;

	-- north is 0, count clockwise
	player.dir = 0

end

function move_player()
	local wind_x, wind_y = wind_force_on_player()

	player.dx += wind_x
	player.dy += wind_y

	-- Add water drag
	player.dx -= abs(player.dx) * player.dx * water_drag
	player.dy -= abs(player.dy) * player.dy * water_drag

	player.x += player.dx * overall_player_speed
	player.y += player.dy * overall_player_speed
end
-- TODO: use metatable to implement vectors and use those for velocity stuff

function wind_force_on_player()
	-- move player from the wind
	-- hardcode to just south at first
	dx = 0;
	dy = 0;
	if (player.dir == 0) then -- north, do nothing
	elseif (player.dir == 1) then -- ne
		dx = 1
		dy = -1
	elseif (player.dir == 2) then -- east
		dx = 2
	elseif (player.dir == 3) then -- se
		dx = 1
		dy = 1
	elseif (player.dir == 4) then -- south
		dy = 1
	elseif (player.dir == 5) then -- sw
		dx = -1
		dy = 1
	elseif (player.dir == 6) then -- west
		dx = -2
	else -- (player.dir == 7) -- nw
		dx = -1
		dy = -1
	end
	return dx, dy
end

function rotate_player()
	if (btnp(0)) player.dir = (player.dir - 1) % 8
	if (btnp(1)) player.dir = (player.dir + 1) % 8
end

function draw_player()
	-- the sprites just happen to be in beginning of sprite sheet
	local sprite = player.dir + 1
	spr(sprite, player.x, player.y)
end

function draw_marks()
	circfill(96, 112, 3, 8)	
	circfill(96, 16, 3, 8)	
	circfill(32, 64, 3, 8)	
end

function draw_water()
	rectfill(0, 0, 127, 127, 12) -- fill screen with light blue
end

function draw_points() 
	print(tostr(player_points[1]), 4, 4, 0)
end

__gfx__
00000000000400000500000000000000000400000047444000004000000570000000000000000000000000000000000000000000000000000000000000000000
00000000004440000754444044444400007777750077444000044400000577000444400000000000000000000000000000000000000000000000000000000000
00700700044444000775444044444440044777500777444000444470004577740444440000000000000000000000000000000000000000000000000000000000
00077000044555550777544044445444444475407777444004444774044577770445444000000000000000000000000000000000000000000000000000000000
00077000044477774774444077775440044454405555544004457770444544440457444400000000000000000000000000000000000000000000000000000000
00700700044477700744440047775400004444400044444004445770044444440577744000000000000000000000000000000000000000000000000000000000
00000000044477000044400000775000000444400004440004444570004444445777770000000000000000000000000000000000000000000000000000000000
00000000044474000004000000075000000000000000400000000050000000000000400000000000000000000000000000000000000000000000000000000000
cccccccc000880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cccccccc008888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cccccccc888888800070070000700700007007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cccccccc888888880007700000077000000770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cccccccc888888880007700000077000000770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cccccccc888888800070070000700700007007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cccccccc008888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cccccccc000880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
