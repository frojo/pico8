pico-8 cartridge // http://www.pico-8.com
version 18
__lua__


function _init()
  yuzhu = {}
  yuzhu.x = 50
  yuzhu.y = 50
  yuzhu.dx = 0
  yuzhu.dy = 0

  yuzhu.anim = {}
  -- either idling or running
  yuzhu.anim.is_idle = true
  -- used for flipping sprites for animation
  yuzhu.anim.timer = 0
  yuzhu.anim.flipped = false

  words = {}
end

function draw_idle()
  if flr(yuzhu.anim.timer / 30) % 2 == 0 then
    spr(1, yuzhu.x, yuzhu.y, 1, 1, yuzhu.anim.flipped)
  else
    spr(2, yuzhu.x, yuzhu.y, 1, 1, yuzhu.anim.flipped)
  end
end

function draw_running()
  if flr(yuzhu.anim.timer / 4) % 2 == 0 then
    spr(3, yuzhu.x, yuzhu.y, 1, 1, yuzhu.anim.flipped)
  else
    spr(4, yuzhu.x, yuzhu.y, 1, 1, yuzhu.anim.flipped)
  end
end

function _draw()
  cls()
  rectfill(0, 0, 128, 128, 15)

  map(0, 0, 0, 0, 16, 16)

  -- draw yuzhu
  pal(12, 140, 1)
  palt(0, false)
  palt(7, true)

  if grounded() and yuzhu.dx == 0 then
    -- animate idle
    draw_idle()
  else
    draw_running()
  end

  for word in all(words) do
    word:draw()
  end

  --print(grounded(yuzhu), 0, 0, 8)
  -- print(mget(yuzhu.x*8, yuzhu.y*8+1), 0, 0, 8)
  print(yuzhu.anim.flipped, 0, 0, 8)
end

function screen_to_map(screen_pos)
  return screen_pos*8
end

function grounded()
  return fget(mget(yuzhu.x/8, yuzhu.y/8+1), 0)
end


function m_word(x, y, left)
  local word = {}

  word.text = 'plum'
  word.x = x
  word.y = y

  if left then
    word.dx = -1
  else
    word.dx = 1
  end
  word.dy = 0

  word.update = function(self)
    self.x += self.dx
  end

  word.draw = function(self)
    print(self.text, x, y, 8)
  end

  return word
end

function shoot_word(x, y, left)
  add(words, m_word(x, y, left))
end

function _update()

  -- horizontal movement (including bounds)
  yuzhu.dx = 0
  if btn(0) and yuzhu.x > -2 then
    yuzhu.dx = -1
  elseif btn(1) and yuzhu.x < 122 then
    yuzhu.dx = 1
  end

  -- vertical movement (including jump)
  if btn(2) and grounded() then
    -- jump
    yuzhu.dy = -2
  elseif grounded() then
    yuzhu.dy = 0
  else
    yuzhu.dy += .1
  end
  -- don't let her fall too fast
  yuzhu.dy = min(yuzhu.dy, 1.8)


  if btn(5) then
    shoot_word(yuzhu.x, yuzhu.y, yuzhu.flipped)
  end

  -- handle animation things
  local idle_this_frame = grounded() and yuzhu.dx == 0
  if idle_this_frame and not yuzhu.anim.is_idle then
    -- yuhzu was running last frame and is idle now
    yuzhu.anim.timer = 0
  elseif not idle_this_frame and yuzhu.anim.is_idle then
    -- yuhzu was idle last frame is running now
    yuzhu.anim.timer = 0
  end
  yuzhu.anim.is_idle = idle_this_frame
  yuzhu.anim.timer += 1

  if yuzhu.dx < 0 then
    yuzhu.anim.flipped = false
  elseif yuzhu.dx > 0 then
    yuzhu.anim.flipped = true
  end

	
  yuzhu.y += yuzhu.dy
  yuzhu.x += yuzhu.dx

  for word in all(words) do
    word:update()
  end

end
__gfx__
00000000770000077777777777000007770000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000077ccc0077700000777ccc00777ccc0070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700770c0c0777ccc007770c0c07770c0c070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000770c0c07770c0c07770c0c07770c0c070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700077cccc07770c0c0777cccc0777cccc070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007007770007777cccc0777700077777000770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777000777770007777b00077777000b70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777b7b77777b7b7777777b77777b77770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000001111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
