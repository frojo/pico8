pico-8 cartridge // http://www.pico-8.com
version 16
__lua__

-- based of the gdc tech talk for noita

debug = true

sand_parts = {}

sand_col = 10

function _init()

  if debug then
    poke(0x5f2d, 1)
  end


  test_sand = {}
  test_sand.x = 50
  test_sand.y = 50
  add(sand_parts, test_sand)

  test_sand2 = {} 
  test_sand2.x = 50
  test_sand2.y = 60
  add(sand_parts, test_sand2)

end

function _update()

  if debug then
    if stat(34) == 1 then
      part = {}
      part.x = stat(32)
      part.y = stat(33)
      add(sand_parts, part)
    end
  end

  for part in all(sand_parts) do
    if part.y < 127 then
      if pget(part.x, part.y + 1) != sand_col then
	part.y += 1
      end
    end
  end

end


function _draw()

  cls(0)
  for part in all(sand_parts) do

    pset(part.x, part.y, sand_col)

  end

  if debug then
    -- draw cursor
    spr(1, stat(32), stat(33))
  end

end




__gfx__
00000000000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000770007700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
